# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ShadowCanvas  Â·  Backend CI/CD Pipeline
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Triggers on every push and PR that touches backend code.
# Jobs: Install & Validate â†’ (Test â€” when tests exist) â†’ (Deploy â€” placeholder)
#
# Required GitHub Secrets (set in Settings â†’ Secrets & Variables â†’ Actions):
#   MONGO_URI, JWT_SECRET, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET,
#   GITHUB_CLIENT_ID_OAUTH, GITHUB_CLIENT_SECRET_OAUTH,
#   EMAIL_USER, EMAIL_PASS

name: Backend CI/CD

on:
  push:
    branches: [main, develop]
    paths:
      - "backend/**"
      - ".github/workflows/backend-ci.yml"
  pull_request:
    branches: [main]
    paths:
      - "backend/**"
      - ".github/workflows/backend-ci.yml"

defaults:
  run:
    working-directory: backend

jobs:
  # â”€â”€ 1. Install & Validate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  validate:
    name: âœ… Install & Validate
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: backend/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Check for syntax errors (dry-run parse)
        run: node --check src/index.js

  # â”€â”€ 2. Test (ready when test suite is added) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # test:
  #   name: ðŸ§ª Test
  #   runs-on: ubuntu-latest
  #   needs: validate
  #   env:
  #     MONGO_URI: ${{ secrets.MONGO_URI }}
  #     JWT_SECRET: ${{ secrets.JWT_SECRET }}
  #     GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
  #     GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
  #     GITHUB_CLIENT_ID: ${{ secrets.GITHUB_CLIENT_ID_OAUTH }}
  #     GITHUB_CLIENT_SECRET: ${{ secrets.GITHUB_CLIENT_SECRET_OAUTH }}
  #     EMAIL_USER: ${{ secrets.EMAIL_USER }}
  #     EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
  #     PORT: 5000
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     - name: Setup Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: 20
  #         cache: npm
  #         cache-dependency-path: backend/package-lock.json
  #
  #     - name: Install dependencies
  #       run: npm ci
  #
  #     - name: Run tests
  #       run: npm test

  # â”€â”€ 3. Deploy (placeholder) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Uncomment and configure when deployment target is ready.
  #
  # deploy:
  #   name: ðŸš€ Deploy
  #   runs-on: ubuntu-latest
  #   needs: test
  #   if: github.ref == 'refs/heads/main' && github.event_name == 'push'
  #   env:
  #     MONGO_URI: ${{ secrets.MONGO_URI }}
  #     JWT_SECRET: ${{ secrets.JWT_SECRET }}
  #     GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
  #     GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
  #     GITHUB_CLIENT_ID: ${{ secrets.GITHUB_CLIENT_ID_OAUTH }}
  #     GITHUB_CLIENT_SECRET: ${{ secrets.GITHUB_CLIENT_SECRET_OAUTH }}
  #     EMAIL_USER: ${{ secrets.EMAIL_USER }}
  #     EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     - name: Deploy to server
  #       run: echo "Add your deploy command here (Railway, Render, EC2, etc.)"
